import {  Injectable,  CanActivate,  ExecutionContext,  ForbiddenException,} from '@nestjs/common';import { Reflector } from '@nestjs/core';import { PERMISSIONS_KEY } from '../decorators';/** * Guard para verificar permissões de usuários * * @class PermissionsGuard * @implements {CanActivate} */@Injectable()export class PermissionsGuard implements CanActivate {  constructor(private reflector: Reflector) {}  /**   * Verifica se o usuário tem as permissões necessárias   *   * @param {ExecutionContext} context - Contexto da execução   * @returns {boolean} Se o usuário tem permissão   * @throws {ForbiddenException} Se o usuário não tem permissão   */  canActivate(context: ExecutionContext): boolean {    try {      const requiredPermissions = this.reflector.getAllAndOverride<string[]>(        PERMISSIONS_KEY,        [context.getHandler(), context.getClass()],      );      if (!requiredPermissions || requiredPermissions.length === 0) {        return true;      }      const { user } = context.switchToHttp().getRequest();      if (!user || !user.permissions) {        throw new ForbiddenException('Usuário não autenticado');      }      const userPermissions = user.permissions || [];      const hasPermission = requiredPermissions.some((permission) =>        userPermissions.includes(permission),      );      if (!hasPermission) {        throw new ForbiddenException(          'Você não tem permissão para acessar este recurso',        );      }      return true;    } catch (error) {      if (error instanceof ForbiddenException) {        throw error;      }      throw new ForbiddenException('Erro ao verificar permissões');    }  }}